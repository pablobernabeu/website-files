---
title: How to visually assess the convergence of a mixed-effects model by plotting
  various optimizers
author: ''
slug: how-to-visually-assess-the-convergence-of-a-mixed-effects-model-by-plotting-various-optimizers
categories:
  - R
  - statistics
tags:
  - convergence
  - research methods
  - statistics
  - linear-mixed effects models
  - visualisation
  - s
subtitle: ''
summary: ''
authors: []
lastmod: '2023-06-24T16:42:34+02:00'
featured: no
draft: no
image:
  caption: ''
  focal_point: ''
  preview_only: no
projects: []
---



<p>To assess whether convergence warnings render the results invalid, or on the contrary, the results can be deemed valid in spite of the warnings, <a href="https://cran.r-project.org/web/packages/lme4/lme4.pdf">Bates et al. (2023)</a> suggest refitting models affected by convergence warnings with a variety of optimizers. The authors argue that, if the different optimizers produce practically-equivalent results, the results are valid. The <code>allFit</code> function from the ‘lme4’ package allows the refitting of models using a number of optimizers. To use the seven optimizers listed above, two extra packages must be installed: ‘dfoptim’ and ‘optimx’ (see lme4 manual). The output from <code>allFit</code> contains several statistics on the fixed and the random effects fitted by each optimizer.</p>
<pre class="r"><code>library(lme4)
#&gt; Loading required package: Matrix
library(dfoptim)
library(optimx)

# Create data using code by Ben Bolker from 
# https://stackoverflow.com/a/38296264/7050882

set.seed(101)
spin = runif(600, 1, 24)
reg = runif(600, 1, 15)
ID = rep(c(&quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;,&quot;5&quot;, &quot;6&quot;, &quot;7&quot;, &quot;8&quot;, &quot;9&quot;, &quot;10&quot;))
day = rep(1:30, each = 10)
testdata &lt;- data.frame(spin, reg, ID, day)
testdata$fatigue &lt;- testdata$spin * testdata$reg/10 * rnorm(30, mean=3, sd=2)

# Model
fit = lmer(fatigue ~ spin * reg + (1|ID),
           data = testdata, REML = TRUE)

# Refit model using all available algorithms
multi_fit = allFit(fit)
#&gt; bobyqa : [OK]
#&gt; Nelder_Mead : [OK]
#&gt; nlminbwrap : [OK]
#&gt; nmkbw : [OK]
#&gt; optimx.L-BFGS-B : [OK]
#&gt; nloptwrap.NLOPT_LN_NELDERMEAD : [OK]
#&gt; nloptwrap.NLOPT_LN_BOBYQA : [OK]

# Show results 
summary(multi_fit)$fixef
#&gt;                               (Intercept)      spin       reg  spin:reg
#&gt; bobyqa                          -2.975678 0.5926561 0.1437204 0.1834016
#&gt; Nelder_Mead                     -2.975675 0.5926559 0.1437202 0.1834016
#&gt; nlminbwrap                      -2.975677 0.5926560 0.1437203 0.1834016
#&gt; nmkbw                           -2.975678 0.5926561 0.1437204 0.1834016
#&gt; optimx.L-BFGS-B                 -2.975680 0.5926562 0.1437205 0.1834016
#&gt; nloptwrap.NLOPT_LN_NELDERMEAD   -2.975666 0.5926552 0.1437196 0.1834017
#&gt; nloptwrap.NLOPT_LN_BOBYQA       -2.975678 0.5926561 0.1437204 0.1834016

# Read in function from GitHub
source(&#39;https://raw.githubusercontent.com/pablobernabeu/plot.fixef.allFit/main/plot.fixef.allFit.R&#39;)

plot.fixef.allFit(multi_fit, 
                  
                  select_predictors = c(&#39;spin&#39;, &#39;reg&#39;, &#39;spin:reg&#39;), 
                  
                  # Increase padding at top and bottom of Y axis
                  multiply_y_axis_limits = 1.3,
                  
                  y_title = &#39;Fixed effect (*b*)&#39;)
#&gt; Loading required package: dplyr
#&gt; 
#&gt; Attaching package: &#39;dplyr&#39;
#&gt; The following objects are masked from &#39;package:stats&#39;:
#&gt; 
#&gt;     filter, lag
#&gt; The following objects are masked from &#39;package:base&#39;:
#&gt; 
#&gt;     intersect, setdiff, setequal, union
#&gt; Loading required package: reshape2
#&gt; Loading required package: stringr
#&gt; Loading required package: scales
#&gt; Loading required package: ggplot2
#&gt; Loading required package: ggtext
#&gt; Loading required package: patchwork</code></pre>
<p><img src="XYQDug2.png" /><!-- --></p>
<pre class="r"><code>
# Alternative using plot-specific Y axes and other modified settings

plot.fixef.allFit(multi_fit, 
                  
                  select_predictors = c(&#39;spin&#39;, &#39;spin:reg&#39;), 
                  
                  # Use plot-specific Y axis limits
                  shared_y_axis_limits = FALSE,
                  
                  decimal_places = 7, 
                  
                  # Move up Y axis title
                  y_title_hjust = 4.5,
                  
                  y_title = &#39;Fixed effect (*b*)&#39;)</code></pre>
<p><img src="BYXJYxM.png" /><!-- --></p>
<p><sup>Created on 2023-06-26 with <a href="https://reprex.tidyverse.org">reprex v2.0.2</a></sup></p>
