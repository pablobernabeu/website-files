---
title: R functions for checking and fixing vmrk files from BrainVision
author: ''
date: '2024-06-30'
slug: r-functions-for-checking-and-fixing-vmrk-files-from-BrainVision
categories:
  - research methods
  - R
tags:
  - research methods
  - electroencephalography
  - EEG
  - BrainVision
  - event-related potentials
  - s
subtitle: ''
summary: 'Electroencephalography (EEG) has become a cornerstone for understanding the intricate workings of the human brain in the field of neuroscience. However, EEG software and hardware come with their own set of constraints, particularly in the management of markers, also known as triggers. This article aims to shed light on these limitations and future prospects of marker management in EEG studies, while also introducing R functions that can help deal with vmrk files from BrainVision.'
authors: []
lastmod: ''
featured: no
draft: no
image:
  caption: ''
  focal_point: ''
  preview_only: no
projects: []
---



<p>Electroencephalography (EEG) has become a cornerstone for understanding the intricate workings of the human brain in the field of neuroscience. However, EEG software and hardware come with their own set of constraints, particularly in the management of markers, also known as triggers. This article aims to shed light on these limitations and future prospects of marker management in EEG studies, while also introducing R functions that can help deal with vmrk files from BrainVision.</p>
<p>Markers, serving as timestamps that indicate specific events during data collection, play a crucial role in EEG studies. These events could range from the onset of a stimulus to the participant’s response. However, one of the major constraints in current EEG systems is the limitation of markers to numbers between 1 and 255. This limitation is due to the fact that markers are typically stored as 8-bit unsigned integers in computer memory, which can only represent numbers in the range of 0 to 255. However, the number 0 is usually reserved for system use, leaving only the numbers 1 to 255 available for markers.</p>
<p>This numerical constraint can pose significant challenges in the interpretation of markers, especially in complex experimental designs where a multitude of events need to be marked and differentiated. It necessitates careful documentation of each marker’s purpose prior to running the study. This means that researchers must meticulously map each number to a specific event or condition in their experiment, which can be a daunting task, especially for complex studies with numerous conditions and events.</p>
<p>Looking towards the future, one might wonder if it will become possible to send markers with semantic information, instead of being constrained to numbers between 1 and 255. This would allow researchers to encode more detailed information in each marker, such as the type of stimulus presented or the specific condition being tested. Such a development could revolutionize the way we conduct and analyze EEG studies, offering greater flexibility in experimental design and more nuanced insights into brain activity.</p>
<p>Below, we’ll demonstrate some functions from <a href="https://github.com/pablobernabeu/EEG-tools-and-tips">this GitHub repository</a> that help inspect and fix vmrk files. We’ll work with the vmrk file shown below.</p>
<pre class="r"><code># Read the file into a vector of lines
readLines(&#39;https://raw.githubusercontent.com/pablobernabeu/EEG-tools-and-tips/main/example.vmrk&#39;)</code></pre>
<pre><code>##  [1] &quot;Brain Vision Data Exchange Marker File, Version 1.0&quot;                               
##  [2] &quot;&quot;                                                                                  
##  [3] &quot;[Common Infos]&quot;                                                                    
##  [4] &quot;DataFile=3.eeg&quot;                                                                    
##  [5] &quot;Codepage=utf-8&quot;                                                                    
##  [6] &quot;&quot;                                                                                  
##  [7] &quot;[Marker Infos]&quot;                                                                    
##  [8] &quot;; Each entry: Mk&lt;Marker number&gt;=&lt;Type&gt;,&lt;Description&gt;,&lt;Position in data points&gt;,&quot;   
##  [9] &quot;; &lt;Size in data points&gt;, &lt;Channel number (0 = marker is related to all channels)&gt;,&quot;
## [10] &quot;; &lt;Date (YYYYMMDDhhmmssuuuuuu)&gt;&quot;                                                   
## [11] &quot;; Fields are delimited by commas, some fields might be omited (empty).&quot;            
## [12] &quot;; Commas in type or description text are coded as \&quot;\\1\&quot;.&quot;                        
## [13] &quot;Mk1=New Segment,,1,1,0,20240318111955090000&quot;                                       
## [14] &quot;Mk2=Stimulus,S254,20419,1,0&quot;                                                       
## [15] &quot;Mk3=Stimulus,S  5,22332,1,0&quot;                                                       
## [16] &quot;Mk4=Stimulus,S 42,23095,1,0&quot;                                                       
## [17] &quot;Mk5=Stimulus,S143,23100,1,0&quot;                                                       
## [18] &quot;Mk6=Stimulus,S  2,23106,1,0&quot;                                                       
## [19] &quot;Mk7=Stimulus,S102,23111,1,0&quot;                                                       
## [20] &quot;Mk8=Stimulus,S  6,25882,1,0&quot;                                                       
## [21] &quot;Mk9=Stimulus,S  5,28106,1,0&quot;                                                       
## [22] &quot;Mk10=Stimulus,S 50,29053,1,0&quot;                                                      
## [23] &quot;Mk11=Stimulus,S241,29058,1,0&quot;                                                      
## [24] &quot;Mk12=Stimulus,S  1,29063,1,0&quot;                                                      
## [25] &quot;Mk13=Stimulus,S101,29069,1,0&quot;                                                      
## [26] &quot;Mk14=Stimulus,S  6,31830,1,0&quot;                                                      
## [27] &quot;Mk15=Stimulus,S  5,34056,1,0&quot;                                                      
## [28] &quot;Mk16=Stimulus,S 49,35055,1,0&quot;                                                      
## [29] &quot;Mk17=Stimulus,S226,35060,1,0&quot;                                                      
## [30] &quot;Mk18=Stimulus,S  2,35066,1,0&quot;                                                      
## [31] &quot;Mk19=Stimulus,S103,35071,1,0&quot;                                                      
## [32] &quot;Mk20=Stimulus,S  6,37242,1,0&quot;                                                      
## [33] &quot;Mk21=Stimulus,S  5,39436,1,0&quot;                                                      
## [34] &quot;Mk22=Stimulus,S 43,40417,1,0&quot;                                                      
## [35] &quot;Mk23=Stimulus,S155,40423,1,0&quot;                                                      
## [36] &quot;Mk24=Stimulus,S  2,40429,1,0&quot;                                                      
## [37] &quot;Mk25=Stimulus,S103,40434,1,0&quot;                                                      
## [38] &quot;Mk26=Stimulus,S  6,42481,1,0&quot;                                                      
## [39] &quot;Mk27=Stimulus,S  5,44662,1,0&quot;                                                      
## [40] &quot;Mk28=Stimulus,S 40,45678,1,0&quot;                                                      
## [41] &quot;Mk29=Stimulus,S118,45683,1,0&quot;                                                      
## [42] &quot;Mk30=Stimulus,S  1,45688,1,0&quot;                                                      
## [43] &quot;Mk31=Stimulus,S103,45693,1,0&quot;                                                      
## [44] &quot;Mk32=Stimulus,S  6,47621,1,0&quot;                                                      
## [45] &quot;Mk33=Stimulus,S  5,49809,1,0&quot;                                                      
## [46] &quot;Mk34=Stimulus,S 50,50808,1,0&quot;                                                      
## [47] &quot;Mk35=Stimulus,S237,50813,1,0&quot;                                                      
## [48] &quot;Mk36=Stimulus,S  3,50818,1,0&quot;                                                      
## [49] &quot;Mk37=Stimulus,S101,50823,1,0&quot;                                                      
## [50] &quot;Mk38=Stimulus,S  6,53823,1,0&quot;                                                      
## [51] &quot;Mk39=Stimulus,S  5,56042,1,0&quot;                                                      
## [52] &quot;Mk40=Stimulus,S 40,57129,1,0&quot;                                                      
## [53] &quot;Mk41=Stimulus,S114,57134,1,0&quot;                                                      
## [54] &quot;Mk42=Stimulus,S  3,57140,1,0&quot;                                                      
## [55] &quot;Mk43=Stimulus,S103,57145,1,0&quot;                                                      
## [56] &quot;Mk44=Stimulus,S  6,59661,1,0&quot;</code></pre>
<p><br></p>
<div id="numbering-trials" class="section level2">
<h2>Numbering trials</h2>
<p>The antediluvian limitation of markers often prevents us from storing the order of trials using markers. Thus, when we need to inspect or fix vmrk files, we must mentally divide the lines into trials. For instance, in our example vmrk file, all trials begin with the marker <code>S  5</code>. The function below allows us to temporarily number trials by appending the number to the first marker of each trial. The parameters of the function allow us to select the <code>start_line</code> to skip the metadata at the top of the vmrk file, as well as to select the number of <code>lines_per_trial</code> and the <code>first_number</code> to use in the first trial.</p>
<script src="https://emgithub.com/embed-v2.js?target=https%3A%2F%2Fgithub.com%2Fpablobernabeu%2FEEG-tools-and-tips%2Fblob%2Fmain%2Fnumber_trials.R%23L3-L18&style=a11y-dark&type=code&showLineNumbers=on&showFileMeta=on&showCopy=on&fetchFromJsDelivr=on"></script>
<pre class="r"><code># Create temporary vmrk file with numbered trials

source(&#39;https://raw.githubusercontent.com/pablobernabeu/EEG-tools-and-tips/main/number_trials.R&#39;)

number_trials(&#39;https://raw.githubusercontent.com/pablobernabeu/EEG-tools-and-tips/main/example.vmrk&#39;, 
              start_line = 15, lines_per_trial = 6, first_number = 1)</code></pre>
<pre><code>##  [1] &quot;Brain Vision Data Exchange Marker File, Version 1.0&quot;                               
##  [2] &quot;&quot;                                                                                  
##  [3] &quot;[Common Infos]&quot;                                                                    
##  [4] &quot;DataFile=3.eeg&quot;                                                                    
##  [5] &quot;Codepage=utf-8&quot;                                                                    
##  [6] &quot;&quot;                                                                                  
##  [7] &quot;[Marker Infos]&quot;                                                                    
##  [8] &quot;; Each entry: Mk&lt;Marker number&gt;=&lt;Type&gt;,&lt;Description&gt;,&lt;Position in data points&gt;,&quot;   
##  [9] &quot;; &lt;Size in data points&gt;, &lt;Channel number (0 = marker is related to all channels)&gt;,&quot;
## [10] &quot;; &lt;Date (YYYYMMDDhhmmssuuuuuu)&gt;&quot;                                                   
## [11] &quot;; Fields are delimited by commas, some fields might be omited (empty).&quot;            
## [12] &quot;; Commas in type or description text are coded as \&quot;\\1\&quot;.&quot;                        
## [13] &quot;Mk1=New Segment,,1,1,0,20240318111955090000&quot;                                       
## [14] &quot;Mk2=Stimulus,S254,20419,1,0&quot;                                                       
## [15] &quot;Mk3=Stimulus,S  5,22332,1,0  1&quot;                                                    
## [16] &quot;Mk4=Stimulus,S 42,23095,1,0&quot;                                                       
## [17] &quot;Mk5=Stimulus,S143,23100,1,0&quot;                                                       
## [18] &quot;Mk6=Stimulus,S  2,23106,1,0&quot;                                                       
## [19] &quot;Mk7=Stimulus,S102,23111,1,0&quot;                                                       
## [20] &quot;Mk8=Stimulus,S  6,25882,1,0&quot;                                                       
## [21] &quot;Mk9=Stimulus,S  5,28106,1,0  2&quot;                                                    
## [22] &quot;Mk10=Stimulus,S 50,29053,1,0&quot;                                                      
## [23] &quot;Mk11=Stimulus,S241,29058,1,0&quot;                                                      
## [24] &quot;Mk12=Stimulus,S  1,29063,1,0&quot;                                                      
## [25] &quot;Mk13=Stimulus,S101,29069,1,0&quot;                                                      
## [26] &quot;Mk14=Stimulus,S  6,31830,1,0&quot;                                                      
## [27] &quot;Mk15=Stimulus,S  5,34056,1,0  3&quot;                                                   
## [28] &quot;Mk16=Stimulus,S 49,35055,1,0&quot;                                                      
## [29] &quot;Mk17=Stimulus,S226,35060,1,0&quot;                                                      
## [30] &quot;Mk18=Stimulus,S  2,35066,1,0&quot;                                                      
## [31] &quot;Mk19=Stimulus,S103,35071,1,0&quot;                                                      
## [32] &quot;Mk20=Stimulus,S  6,37242,1,0&quot;                                                      
## [33] &quot;Mk21=Stimulus,S  5,39436,1,0  4&quot;                                                   
## [34] &quot;Mk22=Stimulus,S 43,40417,1,0&quot;                                                      
## [35] &quot;Mk23=Stimulus,S155,40423,1,0&quot;                                                      
## [36] &quot;Mk24=Stimulus,S  2,40429,1,0&quot;                                                      
## [37] &quot;Mk25=Stimulus,S103,40434,1,0&quot;                                                      
## [38] &quot;Mk26=Stimulus,S  6,42481,1,0&quot;                                                      
## [39] &quot;Mk27=Stimulus,S  5,44662,1,0  5&quot;                                                   
## [40] &quot;Mk28=Stimulus,S 40,45678,1,0&quot;                                                      
## [41] &quot;Mk29=Stimulus,S118,45683,1,0&quot;                                                      
## [42] &quot;Mk30=Stimulus,S  1,45688,1,0&quot;                                                      
## [43] &quot;Mk31=Stimulus,S103,45693,1,0&quot;                                                      
## [44] &quot;Mk32=Stimulus,S  6,47621,1,0&quot;                                                      
## [45] &quot;Mk33=Stimulus,S  5,49809,1,0  6&quot;                                                   
## [46] &quot;Mk34=Stimulus,S 50,50808,1,0&quot;                                                      
## [47] &quot;Mk35=Stimulus,S237,50813,1,0&quot;                                                      
## [48] &quot;Mk36=Stimulus,S  3,50818,1,0&quot;                                                      
## [49] &quot;Mk37=Stimulus,S101,50823,1,0&quot;                                                      
## [50] &quot;Mk38=Stimulus,S  6,53823,1,0&quot;                                                      
## [51] &quot;Mk39=Stimulus,S  5,56042,1,0  7&quot;                                                   
## [52] &quot;Mk40=Stimulus,S 40,57129,1,0&quot;                                                      
## [53] &quot;Mk41=Stimulus,S114,57134,1,0&quot;                                                      
## [54] &quot;Mk42=Stimulus,S  3,57140,1,0&quot;                                                      
## [55] &quot;Mk43=Stimulus,S103,57145,1,0&quot;                                                      
## [56] &quot;Mk44=Stimulus,S  6,59661,1,0&quot;</code></pre>
<p><br></p>
</div>
<div id="removing-trial-numbers" class="section level2">
<h2>Removing trial numbers</h2>
<p>For the following demo, we’ll use an <a href="https://github.com/pablobernabeu/EEG-tools-and-tips/blob/main/example_numbered_trials.vmrk">example file with numbered trials</a>.</p>
<script src="https://emgithub.com/embed-v2.js?target=https%3A%2F%2Fgithub.com%2Fpablobernabeu%2FEEG-tools-and-tips%2Fblob%2Fmain%2Fremove_trial_numbers.R%23L3-L18&style=a11y-dark&type=code&showLineNumbers=on&showFileMeta=on&showCopy=on&fetchFromJsDelivr=on"></script>
<pre class="r"><code># Remove trial numbers from temporary vmrk file

source(&#39;https://raw.githubusercontent.com/pablobernabeu/EEG-tools-and-tips/main/remove_trial_numbers.R&#39;)

remove_trial_numbers(&#39;https://raw.githubusercontent.com/pablobernabeu/EEG-tools-and-tips/main/example_numbered_trials.vmrk&#39;)</code></pre>
<pre><code>##  [1] &quot;Brain Vision Data Exchange Marker File, Version 1.0&quot;                               
##  [2] &quot;&quot;                                                                                  
##  [3] &quot;[Common Infos]&quot;                                                                    
##  [4] &quot;DataFile=3.eeg&quot;                                                                    
##  [5] &quot;Codepage=utf-8&quot;                                                                    
##  [6] &quot;&quot;                                                                                  
##  [7] &quot;[Marker Infos]&quot;                                                                    
##  [8] &quot;; Each entry: Mk&lt;Marker number&gt;=&lt;Type&gt;,&lt;Description&gt;,&lt;Position in data points&gt;,&quot;   
##  [9] &quot;; &lt;Size in data points&gt;, &lt;Channel number (0 = marker is related to all channels)&gt;,&quot;
## [10] &quot;; &lt;Date (YYYYMMDDhhmmssuuuuuu)&gt;&quot;                                                   
## [11] &quot;; Fields are delimited by commas, some fields might be omited (empty).&quot;            
## [12] &quot;; Commas in type or description text are coded as \&quot;\\1\&quot;.&quot;                        
## [13] &quot;Mk1=New Segment,,1,1,0,20240318111955090000&quot;                                       
## [14] &quot;Mk2=Stimulus,S254,20419,1,0&quot;                                                       
## [15] &quot;Mk3=Stimulus,S  5,22332,1,0&quot;                                                       
## [16] &quot;Mk4=Stimulus,S 42,23095,1,0&quot;                                                       
## [17] &quot;Mk5=Stimulus,S143,23100,1,0&quot;                                                       
## [18] &quot;Mk6=Stimulus,S  2,23106,1,0&quot;                                                       
## [19] &quot;Mk7=Stimulus,S102,23111,1,0&quot;                                                       
## [20] &quot;Mk8=Stimulus,S  6,25882,1,0&quot;                                                       
## [21] &quot;Mk9=Stimulus,S  5,28106,1,0&quot;                                                       
## [22] &quot;Mk10=Stimulus,S 50,29053,1,0&quot;                                                      
## [23] &quot;Mk11=Stimulus,S241,29058,1,0&quot;                                                      
## [24] &quot;Mk12=Stimulus,S  1,29063,1,0&quot;                                                      
## [25] &quot;Mk13=Stimulus,S101,29069,1,0&quot;                                                      
## [26] &quot;Mk14=Stimulus,S  6,31830,1,0&quot;                                                      
## [27] &quot;Mk15=Stimulus,S  5,34056,1,0&quot;                                                      
## [28] &quot;Mk16=Stimulus,S 49,35055,1,0&quot;                                                      
## [29] &quot;Mk17=Stimulus,S226,35060,1,0&quot;                                                      
## [30] &quot;Mk18=Stimulus,S  2,35066,1,0&quot;                                                      
## [31] &quot;Mk19=Stimulus,S103,35071,1,0&quot;                                                      
## [32] &quot;Mk20=Stimulus,S  6,37242,1,0&quot;                                                      
## [33] &quot;Mk21=Stimulus,S  5,39436,1,0&quot;                                                      
## [34] &quot;Mk22=Stimulus,S 43,40417,1,0&quot;                                                      
## [35] &quot;Mk23=Stimulus,S155,40423,1,0&quot;                                                      
## [36] &quot;Mk24=Stimulus,S  2,40429,1,0&quot;                                                      
## [37] &quot;Mk25=Stimulus,S103,40434,1,0&quot;                                                      
## [38] &quot;Mk26=Stimulus,S  6,42481,1,0&quot;                                                      
## [39] &quot;Mk27=Stimulus,S  5,44662,1,0&quot;                                                      
## [40] &quot;Mk28=Stimulus,S 40,45678,1,0&quot;                                                      
## [41] &quot;Mk29=Stimulus,S118,45683,1,0&quot;                                                      
## [42] &quot;Mk30=Stimulus,S  1,45688,1,0&quot;                                                      
## [43] &quot;Mk31=Stimulus,S103,45693,1,0&quot;                                                      
## [44] &quot;Mk32=Stimulus,S  6,47621,1,0&quot;                                                      
## [45] &quot;Mk33=Stimulus,S  5,49809,1,0&quot;                                                      
## [46] &quot;Mk34=Stimulus,S 50,50808,1,0&quot;                                                      
## [47] &quot;Mk35=Stimulus,S237,50813,1,0&quot;                                                      
## [48] &quot;Mk36=Stimulus,S  3,50818,1,0&quot;                                                      
## [49] &quot;Mk37=Stimulus,S101,50823,1,0&quot;                                                      
## [50] &quot;Mk38=Stimulus,S  6,53823,1,0&quot;                                                      
## [51] &quot;Mk39=Stimulus,S  5,56042,1,0&quot;                                                      
## [52] &quot;Mk40=Stimulus,S 40,57129,1,0&quot;                                                      
## [53] &quot;Mk41=Stimulus,S114,57134,1,0&quot;                                                      
## [54] &quot;Mk42=Stimulus,S  3,57140,1,0&quot;                                                      
## [55] &quot;Mk43=Stimulus,S103,57145,1,0&quot;                                                      
## [56] &quot;Mk44=Stimulus,S  6,59661,1,0&quot;</code></pre>
<p><br></p>
</div>
<div id="counting-markers" class="section level2">
<h2>Counting markers</h2>
<script src="https://emgithub.com/embed-v2.js?target=https%3A%2F%2Fgithub.com%2Fpablobernabeu%2FEEG-tools-and-tips%2Fblob%2Fmain%2Fcount_markers.R%23L3-L18&style=a11y-dark&type=code&showLineNumbers=on&showFileMeta=on&showCopy=on&fetchFromJsDelivr=on"></script>
<pre class="r"><code>source(&#39;https://raw.githubusercontent.com/pablobernabeu/EEG-tools-and-tips/main/count_markers.R&#39;)

count_markers(file = &#39;https://raw.githubusercontent.com/pablobernabeu/EEG-tools-and-tips/main/example.vmrk&#39;, 
              marker = &#39;S  2&#39;)</code></pre>
<pre><code>## Count of &quot;S  2&quot;: 3 instances</code></pre>
</div>
