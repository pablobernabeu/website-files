---
title: How to discretise the colour variable in sjPlot::plot_model into equally-sized intervals
author: ''
slug: how-to-discretise-colour-variable-in-sjplot-plot-model-into-equally-sized-intervals
aliases:
  - /2023/how-to-break-down-colour-variable-in-sjplot-plot-model-into-equally-sized-bins/
categories:
  - R
  - statistics
tags:
  - visualisation
  - linear-mixed effects models
  - interactions
  - binning
  - sjPlot
  - individual differences
  - s
subtitle: ''
summary: ''
authors: []
lastmod: '2023-06-24T16:54:46+02:00'
featured: no
draft: no
image:
  caption: ''
  focal_point: ''
  preview_only: no
projects: []
---



<p>Whereas the direction of main effects can be interpreted from the sign of the estimate, the interpretation of interaction effects often requires plots. This task is facilitated by the R package <a href="https://strengejacke.github.io/sjPlot"><code>sjPlot</code></a>. For instance, using the <code>plot_model</code> function, I plotted the interaction between two continuous variables.</p>
<pre class="r"><code>library(lme4)
#&gt; Loading required package: Matrix
library(sjPlot)
#&gt; Learn more about sjPlot with &#39;browseVignettes(&quot;sjPlot&quot;)&#39;.
library(ggplot2)

theme_set(theme_sjplot())

# Create data partially based on code by Ben Bolker  
# from https://stackoverflow.com/a/38296264/7050882

set.seed(101)

spin = runif(800, 1, 24)

trait = rep(1:40, each = 20)

ID = rep(1:80, each = 10)

testdata &lt;- data.frame(spin, trait, ID)

testdata$fatigue &lt;- 
  testdata$spin * testdata$trait / 
  rnorm(800, mean = 6, sd = 2)

# Model
fit = lmer(fatigue ~ spin * trait + (1|ID),
           data = testdata, REML = TRUE)
#&gt; boundary (singular) fit: see help(&#39;isSingular&#39;)

plot_model(fit, type = &#39;pred&#39;, terms = c(&#39;spin&#39;, &#39;trait&#39;))
#&gt; Warning: Ignoring unknown parameters: linewidth</code></pre>
<p><img src="7VTcfLu.png" /><!-- --></p>
<p><sup>Created on 2023-06-24 with <a href="https://reprex.tidyverse.org">reprex v2.0.2</a></sup></p>
<p>However, I needed an extra feature, as sjPlot by default breaks down the colour (<code>fill</code>) variable into few levels that do not include the minimum or the maximum values in my variable. What I would like to do is to stratify the colour variable into equally-sized levels that include the minimum and the maximum values.</p>
<p>Furthermore, in the legend, I would also like to display the number of levels of a grouping variable (<code>ID</code>) that are contained in each level of the colour variable.</p>
<p>Below is a solution using <a href="/2022/plotting-two-way-interactions-from-mixed-effects-models-using-ten-or-six-bins">custom functions called <code>deciles_interaction_plot</code> and <code>sextiles_interaction_plot</code></a>.</p>
<pre class="r"><code>library(lme4)
#&gt; Loading required package: Matrix
library(sjPlot)
library(ggplot2)

theme_set(theme_sjplot())

# Create data partially based on code by Ben Bolker  
# from https://stackoverflow.com/a/38296264/7050882

set.seed(101)

spin = runif(800, 1, 24)

trait = rep(1:40, each = 20)

ID = rep(1:80, each = 10)

testdata &lt;- data.frame(spin, trait, ID)

testdata$fatigue &lt;- 
  testdata$spin * testdata$trait / 
  rnorm(800, mean = 6, sd = 2)

# Model
fit = lmer(fatigue ~ spin * trait + (1|ID),
           data = testdata, REML = TRUE)
#&gt; boundary (singular) fit: see help(&#39;isSingular&#39;)

# plot_model(fit, type = &#39;pred&#39;, terms = c(&#39;spin&#39;, &#39;trait&#39;))

# Binning the colour variable into ten levels (deciles)

# Read in function from GitHub
source(&#39;https://raw.githubusercontent.com/pablobernabeu/language-sensorimotor-simulation-PhD-thesis/main/R_functions/deciles_interaction_plot.R&#39;)

deciles_interaction_plot(
  model = fit, 
  x = &#39;spin&#39;,
  fill = &#39;trait&#39;,
  fill_nesting_factor = &#39;ID&#39;
)
#&gt; Loading required package: dplyr
#&gt; 
#&gt; Attaching package: &#39;dplyr&#39;
#&gt; The following objects are masked from &#39;package:stats&#39;:
#&gt; 
#&gt;     filter, lag
#&gt; The following objects are masked from &#39;package:base&#39;:
#&gt; 
#&gt;     intersect, setdiff, setequal, union
#&gt; Loading required package: RColorBrewer
#&gt; Loading required package: ggtext
#&gt; Loading required package: Cairo
#&gt; Warning in RColorBrewer::brewer.pal(n, pal): n too large, allowed maximum for palette Set1 is 9
#&gt; Returning the palette you asked for with that many colors
#&gt; Warning: Ignoring unknown parameters: linewidth
#&gt; Scale for &#39;y&#39; is already present. Adding another scale for &#39;y&#39;, which will
#&gt; replace the existing scale.
#&gt; Scale for &#39;colour&#39; is already present. Adding another scale for &#39;colour&#39;,
#&gt; which will replace the existing scale.</code></pre>
<p><img src="niqWOzx.png" /><!-- --></p>
<pre class="r"><code>
# If you wanted or needed to make six levels (sextiles) instead 
# of ten, you could use the function sextiles_interaction_plot.

# Read in function from GitHub
source(&#39;https://raw.githubusercontent.com/pablobernabeu/language-sensorimotor-simulation-PhD-thesis/main/R_functions/sextiles_interaction_plot.R&#39;)

sextiles_interaction_plot(
  model = fit, 
  x = &#39;spin&#39;,
  fill = &#39;trait&#39;,
  fill_nesting_factor = &#39;ID&#39;
)
#&gt; Warning: Ignoring unknown parameters: linewidth
#&gt; Scale for &#39;y&#39; is already present. Adding another scale for &#39;y&#39;, which will
#&gt; replace the existing scale.
#&gt; Scale for &#39;colour&#39; is already present. Adding another scale for &#39;colour&#39;,
#&gt; which will replace the existing scale.</code></pre>
<p><img src="w8Ydo4F.png" /><!-- --></p>
<p><sup>Created on 2023-06-24 with <a href="https://reprex.tidyverse.org">reprex v2.0.2</a></sup></p>
