{{- define "main" -}}

{{ partial "page_header.html" . }}

<div class="universal-wrapper">
  {{ with .Content }}
  <div class="article-style">{{ . }}</div>
  {{ end }}

  {{- /* Filter pages: exclude posts without the "s" tag */ -}}
  {{- $filteredPages := slice -}}
  {{- range .Data.Pages -}}
    {{- $shouldInclude := true -}}
    {{- /* If this is a post (Section = "post"), check for "s" tag */ -}}
    {{- if eq .Section "post" -}}
      {{- $hasStag := false -}}
      {{- range .Params.Tags -}}
        {{- if eq . "s" -}}
          {{- $hasStag = true -}}
        {{- end -}}
      {{- end -}}
      {{- if not $hasStag -}}
        {{- $shouldInclude = false -}}
      {{- end -}}
    {{- end -}}
    {{- if $shouldInclude -}}
      {{- $filteredPages = $filteredPages | append . -}}
    {{- end -}}
  {{- end -}}

  {{ $paginator := .Paginate $filteredPages }}
  {{ range $paginator.Pages }}
    {{ $link := .RelPermalink }}
    {{ $target := "" }}
    {{ with .Params.external_link }}
      {{ $link = . }}
      {{ $target = "target=\"_blank\" rel=\"noopener\"" }}
    {{ end }}
    <div>
      <h2><a href="{{$link}}" {{ $target | safeHTMLAttr }}>{{ .Title | markdownify | emojify }}</a></h2>
      <div class="article-style">
        {{ if .Params.summary }}
          {{ .Params.summary | plainify | emojify }}
        {{ else if .Params.abstract }}
          {{ .Params.abstract | plainify | emojify | truncate 250 }}
        {{ else if .Summary }}
          {{ .Summary | plainify | emojify }}
        {{ end }}
      </div>
    </div>
  {{ end }}

  {{ partial "pagination" . }}
</div>

{{- end -}}
