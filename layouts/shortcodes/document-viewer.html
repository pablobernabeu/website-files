{{/* Document Viewer Shortcode - supports PDF and Word documents */}}
{{/* Usage: {{< document-viewer url="path/to/document.pdf" height="600px" >}} */}}
{{/* Or: {{< document-viewer url="path/to/document.docx" height="600px" viewer="google" >}} */}}

{{ $url := .Get "url" }}
{{ $height := .Get "height" | default "80vh" }}
{{ $title := .Get "title" | default "Document Viewer" }}
{{ $viewer := .Get "viewer" | default "microsoft" }}

{{ if $url }}
  {{ $fileExt := path.Ext $url }}
  {{ $isPDF := or (eq $fileExt ".pdf") (eq $fileExt ".PDF") }}
  {{ $isWord := or (eq $fileExt ".doc") (eq $fileExt ".docx") (eq $fileExt ".DOC") (eq $fileExt ".DOCX") }}
  {{ $fullURL := $url | absURL }}

<div class="document-viewer-container" style="height: {{ $height }}; min-height: 400px;">
  {{ if $isPDF }}
  <iframe src="{{ $url }}" width="100%" height="100%" style="border: none" title="{{ $title }}" loading="lazy">
    <p>Your browser does not support embedded PDFs. <a href="{{ $url }}" target="_blank">Download the PDF</a> instead.</p>
  </iframe>
  {{ else if $isWord }}
    {{ if eq $viewer "google" }}
    <iframe src="https://docs.google.com/viewer?url={{ $fullURL | urlquery }}&embedded=true" width="100%" height="100%" frameborder="0" title="{{ $title }}" loading="lazy">
      <p>Your browser does not support embedded Office documents. <a href="{{ $url }}" target="_blank">Download the document</a> instead.</p>
    </iframe>
    {{ else }}
    <iframe src="https://view.officeapps.live.com/op/embed.aspx?src={{ $fullURL | urlquery }}" width="100%" height="100%" frameborder="0" title="{{ $title }}" loading="lazy">
      <p>Your browser does not support embedded Office documents. <a href="{{ $url }}" target="_blank">Download the document</a> instead.</p>
    </iframe>
    {{ end }}
  {{ else }}
  <div style="padding: 20px; text-align: center">
    <p>Unsupported file type: {{ $fileExt }}</p>
    <p><a href="{{ $url }}" target="_blank" class="btn btn-primary"><i class="fas fa-download"></i> Download Document</a></p>
  </div>
  {{ end }}
</div>
{{ else }}
<div class="alert alert-warning">
  <strong>Error:</strong> No document URL provided. Usage: <code>&lt;&lt; document-viewer url="path/to/file.pdf" &gt;&gt;</code>
</div>
{{ end }}
